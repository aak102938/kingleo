<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>방송 일정표</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
      body {
        background-color: #f0f2f5;
        padding: 20px;
        font-family: sans-serif;
      }
      h1 {
        color: white;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
      }
      .main-container {
        width: 960px;
        height: 540px;
        position: relative;
        margin: 0 auto; /* Center the container */
      }

      .main-container .bg-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        z-index: -1; /* 다른 요소 뒤로 숨기기 */
        pointer-events: none; /* 클릭 방해 안 하게 */
        border-radius: 15px;
      }
      .schedule-container {
        width: 50%;
        height: 100%;
        padding: 2px;
      }
      .schedule-container .schedule-box {
        width: 80%;
        height: 80%;
        margin: 0 auto;
      }
      .schedule-box .day {
        background-color: rgba(255, 255, 255, 0.7);
        width: 100%;
        height: 50px;
        margin: 7px auto;
        display: flex;
        align-items: center;
        padding: 5px;
        padding-left: 10px;
        box-sizing: border-box;
        border-radius: 40px;
        box-shadow: -5px 10px 10px rgba(0, 0, 0, 0.3);
        font-size: 16px;
      }
      .day .day-week {
        width: 50px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border-right: 1px solid #888;
        color: blue;
        font-size: 20px;
        font-weight: bold; /* 굵게 */
        flex-shrink: 0; /* 줄어들지 않도록 */
        margin-right: 10px;
        transition: color 0.3s ease;
      }
      .schedule-text {
        flex-grow: 1;
        cursor: pointer;
        padding: 0 10px;
        color: #000000;
        transition: color 0.3s ease;
      }
      .schedule-text.is-off {
        color: #e74c3c; /* 붉은색 */
      }
      .schedule-input {
        display: none;
        flex-grow: 1;
        border: none;
        background-color: transparent;
        font-family: inherit;
        font-size: inherit;
        color: #000000;
        padding: 0 10px;
        outline: none;
      }
      .day.editing .schedule-text {
        display: none;
      }
      .day.editing .schedule-input {
        display: block;
      }
      .button-container {
        text-align: center;
        margin-top: 20px;
      }
      #capture-btn {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      #capture-btn:hover {
        background-color: #0056b3;
      }
      #result {
        text-align: center;
        margin-top: 10px;
        color: #28a745;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <img src="https://i.imgur.com/yIBQqdK.png" class="bg-img" />
      <div class="schedule-container">
        <center><h1>방송 일정표</h1></center>
        <div class="schedule-box">
          <div class="day">
            <span class="day-week">월</span>
            <span class="schedule-text">일정을 입력하세요</span>
            <input type="text" class="schedule-input" spellcheck="false" />
          </div>
          <div class="day">
            <span class="day-week">화</span>
            <span class="schedule-text">일정을 입력하세요</span>
            <input type="text" class="schedule-input" spellcheck="false" />
          </div>
          <div class="day">
            <span class="day-week">수</span>
            <span class="schedule-text">일정을 입력하세요</span>
            <input type="text" class="schedule-input" spellcheck="false" />
          </div>
          <div class="day">
            <span class="day-week">목</span>
            <span class="schedule-text">일정을 입력하세요</span>
            <input type="text" class="schedule-input" spellcheck="false" />
          </div>
          <div class="day">
            <span class="day-week">금</span>
            <span class="schedule-text">일정을 입력하세요</span>
            <input type="text" class="schedule-input" spellcheck="false" />
          </div>
          <div class="day">
            <span class="day-week">토</span>
            <span class="schedule-text">일정을 입력하세요</span>
            <input type="text" class="schedule-input" spellcheck="false" />
          </div>
          <div class="day">
            <span class="day-week">일</span>
            <span class="schedule-text">일정을 입력하세요</span>
            <input type="text" class="schedule-input" spellcheck="false" />
          </div>
        </div>
      </div>
    </div>

    <div class="button-container">
      <button id="capture-btn">일정표 이미지로 저장</button>
    </div>
    <div id="result"></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const scheduleBox = document.querySelector(".schedule-box");
        const mainContainer = document.querySelector(".main-container");
        const captureBtn = document.getElementById("capture-btn");
        const resultDiv = document.getElementById("result");

        const updateScheduleTextStyle = (textElement) => {
          const text = textElement.textContent;
          if (text.includes("휴방") || text.includes("휴뱅")) {
            textElement.classList.add("is-off");
          } else {
            textElement.classList.remove("is-off");
          }
        };

        document.querySelectorAll(".schedule-text").forEach((el) => {
          updateScheduleTextStyle(el);
        });

        scheduleBox.addEventListener("click", (e) => {
          const scheduleText = e.target.closest(".schedule-text");
          if (!scheduleText) return;

          const day = scheduleText.closest(".day");
          if (day.classList.contains("editing")) return;

          day.classList.add("editing");
          const input = day.querySelector(".schedule-input");
          const text = day.querySelector(".schedule-text");

          if (text.textContent === "일정을 입력하세요") {
            input.value = "";
          } else {
            input.value = text.textContent;
          }
          input.focus();
        });

        const finishEditing = (input) => {
          const day = input.closest(".day");
          if (!day) return;

          const textElement = day.querySelector(".schedule-text");
          const newText = input.value.trim();

          textElement.textContent =
            newText === "" ? "일정을 입력하세요" : newText;

          updateScheduleTextStyle(textElement);

          day.classList.remove("editing");
        };

        scheduleBox.addEventListener("focusout", (e) => {
          if (e.target.classList.contains("schedule-input")) {
            finishEditing(e.target);
          }
        });

        scheduleBox.addEventListener("keydown", (e) => {
          if (!e.target.classList.contains("schedule-input")) return;

          if (e.key === "Enter") {
            finishEditing(e.target);
          } else if (e.key === "Tab") {
            e.preventDefault(); // Stop default tab behavior

            const allDays = Array.from(
              scheduleBox.querySelectorAll(".day")
            );
            const currentDay = e.target.closest(".day");
            const currentIndex = allDays.indexOf(currentDay);

            // Determine next index based on Shift key
            const nextIndex = e.shiftKey
              ? (currentIndex - 1 + allDays.length) % allDays.length
              : (currentIndex + 1) % allDays.length;

            const nextDay = allDays[nextIndex];

            if (nextDay) {
              const nextScheduleText = nextDay.querySelector(".schedule-text");
              if (nextScheduleText) {
                // First, save the current input
                finishEditing(e.target);
                // Then, click the next input to start editing
                nextScheduleText.click();
              }
            }
          }
        });

        captureBtn.addEventListener("click", () => {
          const activeInput = document.querySelector(
            '.schedule-input:not([style*="display: none"])'
          );
          if (activeInput) {
            activeInput.blur();
          }

          resultDiv.textContent = "이미지 생성 중...";

          setTimeout(() => {
            html2canvas(mainContainer, {
              useCORS: true,
              scale: 2,
              backgroundColor: null,
            })
              .then((canvas) => {
                const link = document.createElement("a");
                link.download = "schedule.png";
                link.href = canvas.toDataURL("image/png");
                link.click();
                resultDiv.textContent =
                  "캡처 완료! 이미지가 다운로드되었습니다.";
                setTimeout(() => {
                  resultDiv.textContent = "";
                }, 3000);
              })
              .catch((err) => {
                console.error("oops, something went wrong!", err);
                resultDiv.textContent = "오류 발생! 캡처에 실패했습니다.";
              });
          }, 100);
        });
      });
    </script>
  </body>
</html>
